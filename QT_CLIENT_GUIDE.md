# VideoTransfer Qtå®¢æˆ·ç«¯ - æ¿å¡éƒ¨ç½²æŒ‡å—

## ğŸ¯ æ¦‚è¿°

åŸºäºQt5çš„å›¾å½¢åŒ–è§†é¢‘ä¼ è¾“å®¢æˆ·ç«¯ï¼Œä¸“ä¸ºæ¿å¡éƒ¨ç½²è®¾è®¡ï¼Œæä¾›ç›´è§‚çš„æ“ä½œç•Œé¢ã€‚

## ğŸ–¥ï¸ ç•Œé¢ç‰¹æ€§

### æ·±è‰²ä¸»é¢˜è®¾è®¡
- âœ… **é€‚åˆæ¿å¡æ˜¾ç¤º** - æ·±è‰²èƒŒæ™¯ï¼Œå‡å°‘çœ¼ç–²åŠ³
- âœ… **é«˜å¯¹æ¯”åº¦** - æ¸…æ™°çš„æ–‡å­—å’ŒæŒ‰é’®
- âœ… **ä¸“ä¸šå¤–è§‚** - é€‚åˆå·¥ä¸šç¯å¢ƒ

### ä¸‰åŒºåŸŸå¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ‡é¢˜æ  + èœå•                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                                          â”‚
â”‚   æ§åˆ¶é¢æ¿    â”‚            è§†é¢‘æ˜¾ç¤ºåŒºåŸŸ                    â”‚
â”‚              â”‚                                          â”‚
â”‚  - è¿æ¥è®¾ç½®   â”‚                                          â”‚
â”‚  - è§†é¢‘æ§åˆ¶   â”‚                                          â”‚
â”‚  - çŠ¶æ€ä¿¡æ¯   â”‚                                          â”‚
â”‚              â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ—¥å¿—åŒºåŸŸ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### è¿æ¥ç®¡ç†
- **URLè¾“å…¥** - æ‰‹åŠ¨è¾“å…¥RTSPåœ°å€
- **å¿«é€Ÿè¿æ¥** - é¢„è®¾å¸¸ç”¨URL
  - æœ¬åœ°æµ‹è¯•: `rtsp://localhost:8554/live`
  - æ— äººæœº1: `rtsp://192.168.100.11:8554/drone`
  - æ— äººæœº2: `rtsp://192.168.100.12:8554/drone`
  - æ‰‹æŒç»ˆç«¯: `rtsp://192.168.100.20:8554/handheld`

### è§†é¢‘æ§åˆ¶
- **å®æ—¶æ˜¾ç¤º** - è‡ªåŠ¨ç¼©æ”¾é€‚åº”çª—å£
- **æˆªå›¾åŠŸèƒ½** - ä¿å­˜å½“å‰ç”»é¢åˆ°å›¾ç‰‡ç›®å½•
- **çŠ¶æ€ç›‘æ§** - å®æ—¶æ˜¾ç¤ºè¿æ¥çŠ¶æ€ã€å¸§ç‡ã€åˆ†è¾¨ç‡

### æ—¥å¿—ç³»ç»Ÿ
- **å®æ—¶æ—¥å¿—** - æ˜¾ç¤ºè¿æ¥çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯
- **æ—¶é—´æˆ³** - æ¯æ¡æ—¥å¿—å¸¦æ—¶é—´æ ‡è®°
- **è‡ªåŠ¨æ¸…ç†** - é™åˆ¶æ—¥å¿—è¡Œæ•°ï¼Œé¿å…å†…å­˜å ç”¨

## ğŸš€ ç¼–è¯‘éƒ¨ç½²

### ç³»ç»Ÿè¦æ±‚
```bash
# Ubuntu/Debian
sudo apt install qtbase5-dev qttools5-dev
sudo apt install libavcodec-dev libavformat-dev libavutil-dev libswscale-dev
sudo apt install libopencv-dev

# CentOS/RHEL
sudo yum install qt5-qtbase-devel qt5-qttools-devel
sudo yum install ffmpeg-devel opencv-devel
```

### ç¼–è¯‘æ–¹æ³•
```bash
# æ–¹æ³•1: ä½¿ç”¨ç¼–è¯‘è„šæœ¬
./build_qt_simple.sh

# æ–¹æ³•2: æ‰‹åŠ¨ç¼–è¯‘
cd qt_client_simple
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
```

### æµ‹è¯•è¿è¡Œ
```bash
# å®Œæ•´æµ‹è¯•ï¼ˆåŒ…å«MediaMTX + æ¨æµ + Qtå®¢æˆ·ç«¯ï¼‰
./test_qt_client.sh

# å•ç‹¬è¿è¡ŒQtå®¢æˆ·ç«¯
cd qt_client_simple/build
./videotransfer_qt_simple
```

## ğŸ“± ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬æ“ä½œæµç¨‹
1. **å¯åŠ¨ç¨‹åº** - è¿è¡ŒQtå®¢æˆ·ç«¯
2. **é€‰æ‹©URL** - ä»é¢„è®¾ä¸­é€‰æ‹©æˆ–æ‰‹åŠ¨è¾“å…¥
3. **å»ºç«‹è¿æ¥** - ç‚¹å‡»"è¿æ¥"æŒ‰é’®
4. **æŸ¥çœ‹è§†é¢‘** - å³ä¾§åŒºåŸŸæ˜¾ç¤ºå®æ—¶è§†é¢‘
5. **æˆªå›¾ä¿å­˜** - ç‚¹å‡»"æˆªå›¾"æŒ‰é’®ä¿å­˜ç”»é¢
6. **æ–­å¼€è¿æ¥** - ç‚¹å‡»"æ–­å¼€"æŒ‰é’®

### é¢„è®¾URLè¯´æ˜
| åç§° | URL | ç”¨é€” |
|------|-----|------|
| æœ¬åœ°æµ‹è¯• | `rtsp://localhost:8554/live` | æœ¬æœºæµ‹è¯• |
| æ— äººæœº1 | `rtsp://192.168.100.11:8554/drone` | æ— äººæœºè§†é¢‘æµ |
| æ— äººæœº2 | `rtsp://192.168.100.12:8554/drone` | å¤‡ç”¨æ— äººæœº |
| æ‰‹æŒç»ˆç«¯ | `rtsp://192.168.100.20:8554/handheld` | æ‰‹æŒè®¾å¤‡ |

### çŠ¶æ€æŒ‡ç¤ºå™¨
- **ç»¿è‰²"å·²è¿æ¥"** - è§†é¢‘æµæ­£å¸¸
- **çº¢è‰²"æœªè¿æ¥"** - æ— è¿æ¥æˆ–è¿æ¥å¤±è´¥
- **å¸§ç‡æ˜¾ç¤º** - å®æ—¶å¸§ç‡ç›‘æ§
- **åˆ†è¾¨ç‡æ˜¾ç¤º** - å½“å‰è§†é¢‘åˆ†è¾¨ç‡

## ğŸ”§ æ¿å¡éƒ¨ç½²é…ç½®

### å¯åŠ¨è„šæœ¬
```bash
#!/bin/bash
# /opt/videotransfer/start_client.sh

export DISPLAY=:0
cd /opt/videotransfer
mkdir -p log
./videotransfer_qt_simple > log/client.log 2>&1 &
echo $! > client.pid
```

### ç³»ç»ŸæœåŠ¡
```ini
# /etc/systemd/system/videotransfer-client.service
[Unit]
Description=VideoTransfer Qt Client
After=graphical-session.target

[Service]
Type=forking
User=videotransfer
WorkingDirectory=/opt/videotransfer
ExecStart=/opt/videotransfer/start_client.sh
ExecStop=/bin/kill -TERM $MAINPID
PIDFile=/opt/videotransfer/client.pid
Restart=always

[Install]
WantedBy=graphical-session.target
```

### è‡ªåŠ¨å¯åŠ¨
```bash
# å¯ç”¨æœåŠ¡
sudo systemctl enable videotransfer-client.service
sudo systemctl start videotransfer-client.service

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status videotransfer-client.service
```

## ğŸ›ï¸ ç•Œé¢å®šåˆ¶

### çª—å£å¤§å°è°ƒæ•´
```cpp
// MainWindow.cpp ä¸­ä¿®æ”¹
setMinimumSize(800, 600);  // æœ€å°å°ºå¯¸
resize(1024, 768);         // é»˜è®¤å°ºå¯¸
```

### é¢„è®¾URLä¿®æ”¹
```cpp
// MainWindow.cpp ä¸­çš„ setupUI() å‡½æ•°
presetCombo_->addItem("è‡ªå®šä¹‰åç§°", "rtsp://IP:PORT/PATH");
```

### ä¸»é¢˜é¢œè‰²è°ƒæ•´
```cpp
// main.cpp ä¸­ä¿®æ”¹é¢œè‰²å€¼
darkPalette.setColor(QPalette::Window, QColor(53, 53, 53));
darkPalette.setColor(QPalette::WindowText, Qt::white);
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å†…å­˜ä½¿ç”¨
- **è§†é¢‘ç¼“å†²** - å•å¸§ç¼“å­˜ï¼Œé¿å…å†…å­˜ç§¯ç´¯
- **æ—¥å¿—é™åˆ¶** - æœ€å¤š1000è¡Œæ—¥å¿—
- **è‡ªåŠ¨æ¸…ç†** - å®šæœŸæ¸…ç†æ— ç”¨å¯¹è±¡

### CPUä¼˜åŒ–
- **å¤šçº¿ç¨‹** - è§†é¢‘è§£ç åœ¨ç‹¬ç«‹çº¿ç¨‹
- **ç¡¬ä»¶åŠ é€Ÿ** - æ”¯æŒFFmpegç¡¬ä»¶è§£ç 
- **å¸§ç‡æ§åˆ¶** - é¿å…è¿‡é«˜å¸§ç‡å ç”¨CPU

### ç½‘ç»œä¼˜åŒ–
```cpp
// VideoReceiverä¸­çš„ç½‘ç»œè®¾ç½®
av_dict_set(&options, "rtsp_transport", "tcp", 0);
av_dict_set(&options, "max_delay", "500000", 0);
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. ç¨‹åºæ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥Qtåº“
ldd videotransfer_qt_simple | grep Qt5

# æ£€æŸ¥æ˜¾ç¤ºç¯å¢ƒ
echo $DISPLAY
xhost +local:
```

#### 2. è§†é¢‘æ— æ³•æ˜¾ç¤º
```bash
# æ£€æŸ¥FFmpegåº“
ldd videotransfer_qt_simple | grep av

# æµ‹è¯•RTSPè¿æ¥
ffplay rtsp://localhost:8554/live
```

#### 3. ç•Œé¢æ˜¾ç¤ºå¼‚å¸¸
```bash
# æ£€æŸ¥å­—ä½“
fc-list | grep -i dejavu

# é‡ç½®Qtè®¾ç½®
rm -rf ~/.config/VideoTransfer*
```

### è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨Qtè°ƒè¯•
export QT_LOGGING_RULES="*.debug=true"
./videotransfer_qt_simple

# å¯ç”¨FFmpegè°ƒè¯•
export AV_LOG_LEVEL=debug
./videotransfer_qt_simple
```

## ğŸ“ å¼€å‘æ‰©å±•

### æ·»åŠ æ–°åŠŸèƒ½
1. **å½•åƒåŠŸèƒ½** - é›†æˆFFmpegå½•åˆ¶
2. **å¤šè·¯è§†é¢‘** - æ”¯æŒå¤šä¸ªè§†é¢‘çª—å£
3. **éŸ³é¢‘æ’­æ”¾** - æ·»åŠ éŸ³é¢‘è§£ç æ’­æ”¾
4. **ç½‘ç»œç›‘æ§** - æ˜¾ç¤ºç½‘ç»œçŠ¶æ€å’Œå¸¦å®½

### ä»£ç ç»“æ„
```
qt_client_simple/
â”œâ”€â”€ main.cpp              # ç¨‹åºå…¥å£
â”œâ”€â”€ MainWindow.h/cpp      # ä¸»çª—å£
â”œâ”€â”€ VideoWidget.h/cpp     # è§†é¢‘æ˜¾ç¤ºæ§ä»¶
â””â”€â”€ CMakeLists.txt        # æ„å»ºé…ç½®
```

## ğŸ¯ æ€»ç»“

VideoTransfer Qtå®¢æˆ·ç«¯æä¾›äº†ï¼š
- âœ… **ä¸“ä¸šç•Œé¢** - é€‚åˆæ¿å¡å·¥ä¸šç¯å¢ƒ
- âœ… **ç®€å•æ“ä½œ** - ä¸€é”®è¿æ¥ï¼Œç›´è§‚æ§åˆ¶
- âœ… **ç¨³å®šå¯é ** - åŸºäºæˆç†Ÿçš„Qtå’ŒFFmpeg
- âœ… **æ˜“äºéƒ¨ç½²** - å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶
- âœ… **é«˜åº¦å®šåˆ¶** - å¯æ ¹æ®éœ€æ±‚è°ƒæ•´ç•Œé¢å’ŒåŠŸèƒ½

é€‚åˆåœ¨åº”æ€¥é€šä¿¡ã€æ— äººæœºæ§åˆ¶ã€è§†é¢‘ç›‘æ§ç­‰åœºæ™¯ä¸­ä½¿ç”¨ã€‚
